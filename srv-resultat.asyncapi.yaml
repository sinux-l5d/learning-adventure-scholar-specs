asyncapi: '2.3.0'
info:
  title: Requêtes asynchrone du service Résultat
  version: 0.1.0
  description: Les différentes requêtes utilisant des WebSockets du service Résultat.
channels:
  exercices:
    subscribe:
      summary: Préviens l'IHM qu'un étudiant a commencé un nouvel exercice
      message:
        $ref: '#/components/messages/etudiantCommenceExo'
  tentatives:
    subscribe:
      summary: Préviens l'IHM qu'un étudiant a fait une nouvelle tentative sur un exercice
      message:
        $ref: '#/components/messages/etudiantFaitNouvelleTentative'
  aides :
    subscribe:
      summary: Préviens l'IHM qu'un étudiant a fait une nouvelle demande d'aide
      message:
        $ref: '#/components/messages/etudiantFaitNouvelleDemandeAide'

components:
  messages:
    etudiantCommenceExo:
      name: etudiantCommenceExo
      contentType: application/json
      payload:
        $ref: '#/components/schemas/newExercicePayload'
    etudiantFaitNouvelleTentative:
      name: etudiantFaitNouvelleTentative
      contentType: application/json
      payload:
        $ref: '#/components/schemas/newAttemptPayload'
    etudiantFaitNouvelleDemandeAide :
      name : etudiantFaitNouvelleDemandeAide 
      contentType: application/json
      payload:
        $ref: '#/components/schemas/newAidePayload'
    
  schemas:
    newExercicePayload:
      type: object
      properties:
        idExo:
          type: string
          format: ObjectId
          description: Id natif de Mongo-db
          example: 507f1f77bcf86cd799439011
        nomExo:
          type: string
          format: string
          example: boucle en C
        idEtu: 
          type: string
          pattern: '^[a-zA-Z][a-zA-Z\-]*[a-zA-Z]\.[a-zA-Z][a-zA-Z\-]*[a-zA-Z]$'
          example: david.wayntal
        idSession: 
          type: string
          format: ObjectId
          example: 480f1f77bcf86cd7994354f6
        nomSession:
          type: string
          format: string
          example: Découverte de la programmation
        idSeance:
          type: string
          format: ObjectId
        difficulte:
          type: integer
          minimum: 1
          maximum: 10
        themes:
          type: array
          items:
            type: string
            format: keyword
          description: Mots clés/étiquettes de l'exercice
          example:
            - boucle
            - fonction
            - condition
            - trie
        language:
          type: string
          example: C
        session:
          type: string
          example: L3 gp1 2022
        tempsMoyen:
          type: number
          format: float
          description: Le temps moyen estimé pour cet exerice
        tempsMaximal:
          type: number
          format: float
          description: Le temps maximal mis pour cet exercice
        
        
        aides:
          type: array
          items:
            type: aide
            format: keyword
          description: id et date
          example:[{'65d4f54fsdfsd',2020-01-01T12:00:00.000Z,false}] 

    newAttemptPayload:
      type: object
      properties:
        idExo:
          type: string
          format: ObjectId
          description: Id natif de Mongo-db
          example: 507f1f77bcf86cd799439011
        idEtu: 
          type: string
          pattern: '^[a-zA-Z][a-zA-Z\-]*[a-zA-Z]\.[a-zA-Z][a-zA-Z\-]*[a-zA-Z]$'
          example: david.wayntal
        idSeance:
          type: string
          format: ObjectId
        validationExercice:
          type: boolean
        logErreurs:
          type: string
        dateSoumission:
          type: string
          format: date-time
          description: | 
            Date en UTC : heure française - 2H (RFC 3339 sec. 5.6)

            Exemple : 2020-01-01T12:00:00.000Z correspond à 01/01/2020 à 14h00
        reponseEtudiant:
          type: string

    newAidePayload:
      type: object
      properties:
        idExo:
          type: string
          format: ObjectId
          description: Id natif de Mongo-db
          example: 507f1f77bcf86cd799439011
        idEtu: 
          type: string
          pattern: '^[a-zA-Z][a-zA-Z\-]*[a-zA-Z]\.[a-zA-Z][a-zA-Z\-]*[a-zA-Z]$'
          example: david.wayntal
        idSession:
          type: string
          format: ObjectId
        idSeance:
          type: string
          format: ObjectId
        dateDemande: #pas certain, à vérifier car n'est pas dans le type AideDepuisEtudiant
          type: string
          format: date-time
          description: | 
            Date en UTC : heure française - 2H (RFC 3339 sec. 5.6)

            Exemple : 2020-01-01T12:00:00.000Z correspond à 01/01/2020 à 14h00
        
